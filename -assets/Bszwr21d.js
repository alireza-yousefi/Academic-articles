import{d as B,r as p,j as U,t as c,v as i,x as n,y as f,J,K as T,L as S,M as A,_ as V}from"./DXZ8ldz3.js";import{r as C,u as k}from"./BW4wuNOV.js";const $={class:"flex flex-col w-full p-5 Estedad_FD_Light",style:{direction:"rtl"}},q={class:"flex text-center justify-between mx-28 mt-10"},G={class:"text-center"},K={key:0,class:"text-gray-600 mt-2 pt-3"},Q={key:1,class:"text-gray-600 mt-2 pt-3"},z={class:"text-center"},H={key:0,class:"text-gray-600 mt-2 pt-3"},W={key:1,class:"text-gray-600 mt-2 pt-3"},X={class:"flex justify-center items-center mt-5"},Y={class:"text-lg text-slate-800 font-bold w-full text-center Estedad_FD_Bold"},Z={class:"text-sm text-slate-700 font-bold w-full text-center mt-3"},ee={class:"grid grid-cols-6 gap-5 w-full border-t border-slate-700 mt-2 py-2"},te=B({__name:"english",setup(se){const O=[{count:1,PersonOne:100,PersonOther:0},{count:2,PersonOne:90,PersonOther:60},{count:3,PersonOne:80,PersonOther:50},{count:4,PersonOne:70,PersonOther:40},{count:5,PersonOne:60,PersonOther:30},{count:6,PersonOne:50,PersonOther:25}],g=p([]),m=p(null),v=p(null),w=p({}),h=p([]),x=p(""),y=p(""),I=U(()=>{if(!y.value.trim())return g.value;const s=y.value.toLowerCase();return g.value.filter(t=>!!(t.title&&t.title.toLowerCase().includes(s)||String(t.PriceAll).toLowerCase().includes(s)||String(t.ImpactFactor).toLowerCase().includes(s)||t.Authors.some(e=>e.name&&e.name.toLowerCase().includes(s)||String(e.price).toLowerCase().includes(s)||String(e.percent).toLowerCase().includes(s))))}),L=()=>{y.value=x.value},M=()=>{x.value="",y.value=""},D=(s,t)=>{const e=Math.min(s.length,6),r=O.find(o=>o.count===e);return r?s.map((o,l)=>({name:o,percent:l===0?r.PersonOne:r.PersonOther,price:t*(l===0?r.PersonOne:r.PersonOther)/100})):(console.error("خطا در یافتن درصد مناسب برای تعداد نویسندگان:",e),[])},N=(s,t)=>{let e=s/t*15e6*3;return e<6e6&&(e=6e6),e>6e7&&(e=6e7),e},F=()=>{if(!h.value||h.value.length===0){console.warn("داده‌های فایل مقالات خالی است.");return}console.log("تعداد ردیف‌های مقالات:",h.value.length),g.value=h.value.filter(s=>s.length===22&&s[0]!=="DOI").map(s=>{const t=parseFloat(s[9]),e=s[18],r=s[19].split("*"),o=String(e).trim().toLowerCase();let l=w.value[o];l||(console.warn(`برای مقاله "${e}" مقدار MIF یافت نشد. استفاده از مقدار پیش‌فرض 1.`),l=1);const a=N(t,l),d=D(r,a);return{title:e,ImpactFactor:t,PriceAll:a,Authors:d}}),console.log("داده‌های پردازش شده مقالات:",g.value)},j=s=>{var r;const t=(r=s.target.files)==null?void 0:r[0];if(!t)return;v.value=t;const e=new FileReader;e.readAsArrayBuffer(t),e.onload=o=>{var b;const l=new Uint8Array((b=o.target)==null?void 0:b.result),a=C(l,{type:"array"});if(console.log("نام برگه‌های فایل MIF:",a.SheetNames),!a.SheetNames.includes("MIF")){console.error('تب "MIF" یافت نشد. برگه‌های موجود:',a.SheetNames);return}const d=a.Sheets.MIF,_=k.sheet_to_json(d,{header:1});console.log("داده‌های MIF:",_),_.slice(1).forEach(u=>{if(u.length>=6&&u[0]&&u[5]){const R=String(u[0]).trim().toLowerCase(),P=parseFloat(u[5]);isNaN(P)||(w.value[R]=P)}}),console.log("نگاشت MIF:",w.value),m.value&&F()}},E=s=>{var r;const t=(r=s.target.files)==null?void 0:r[0];if(!t)return;m.value=t;const e=new FileReader;e.readAsArrayBuffer(t),e.onload=o=>{var u;const l=new Uint8Array((u=o.target)==null?void 0:u.result),a=C(l,{type:"array"});console.log("نام برگه‌های فایل مقالات:",a.SheetNames);let d="JCR-2023";a.SheetNames.includes("JCR-2023")||(d=a.SheetNames[0],console.warn('تب "JCR-2023" یافت نشد. استفاده از برگه اول:',d));const _=a.Sheets[d],b=k.sheet_to_json(_,{header:1});h.value=b,console.log("داده‌های خام مقالات:",h.value),v.value?F():(console.warn("فایل MIF هنوز آپلود نشده است."),g.value=[])}};return(s,t)=>(i(),c("div",$,[n("div",q,[n("div",G,[t[1]||(t[1]=n("label",{for:"file1-upload",class:"cursor-pointer bg-blue-500 text-white py-2 px-4 rounded-lg hover:bg-blue-600 transition duration-300"}," انتخاب فایل مقالات ",-1)),n("input",{id:"file1-upload",class:"hidden",type:"file",onChange:E,accept:".xlsx, .xls"},null,32),m.value?(i(),c("p",Q,"فایل انتخاب شده: "+f(m.value.name),1)):(i(),c("p",K,"هیچ فایلی انتخاب نشده است"))]),n("div",z,[t[2]||(t[2]=n("label",{for:"file2-upload",class:"cursor-pointer bg-blue-500 text-white py-2 px-4 rounded-lg hover:bg-blue-600 transition duration-300"}," انتخاب فایل MIF ",-1)),n("input",{id:"file2-upload",class:"hidden",type:"file",onChange:j,accept:".xlsx, .xls"},null,32),v.value?(i(),c("p",W,"فایل انتخاب شده: "+f(v.value.name),1)):(i(),c("p",H,"هیچ فایلی انتخاب نشده است"))])]),n("div",X,[J(n("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>x.value=e),type:"text",placeholder:"جستجو (مثلاً نام یا مبلغ)",class:"border rounded py-2 px-3 w-64"},null,512),[[T,x.value]]),n("button",{onClick:L,class:"bg-green-500 ml-1 text-white py-2 px-4 rounded-lg mr-2"}," جستجو "),n("button",{onClick:M,class:"bg-gray-500 text-white py-2 px-4 rounded-lg"}," حذف جستجو ")]),(i(!0),c(S,null,A(I.value,(e,r)=>(i(),c("div",{key:`data_${r}`,class:"my-2 bg-slate-200 flex flex-col justify-center items-center border border-slate-700 rounded-md p-2"},[n("div",Y,f(e.title),1),n("div",Z," مبلغ کل دریافتی: "+f(e.PriceAll.toLocaleString("fa-IR"))+" ریال ",1),n("div",ee,[(i(!0),c(S,null,A(e.Authors,(o,l)=>(i(),c("div",{key:`author${l}`,class:"my-2 bg-slate-200 flex flex-col justify-start items-center"},[n("span",null,f(o.name),1),n("span",null,"درصد مشارکت: "+f(o.percent)+"%",1),n("span",null,"مبلغ: "+f(o.price.toLocaleString("fa-IR"))+" ریال",1)]))),128))])]))),128))]))}}),oe=V(te,[["__scopeId","data-v-494c6562"]]);export{oe as default};
